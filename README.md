# Carfax Bot Ready

ุจูุช ุชูููุฌุฑุงู ูุน ูุธุงู ุชูุนูู/ุฑุตูุฏ/ุงุดุชุฑุงูุงุช + ุชูููุฏ PDF.
ุงููุถุน ุงูุงูุชุฑุงุถู ูุณุชุฎุฏู ููู `db.json` ูุญูู (ุฐุงูุฑุฉ ููููุฉ) ูุฌููุน ุงูุญุณุงุจุงุช ูุงูุฅุนุฏุงุฏุงุช.

## ุงูุจููุฉ ุซูุงุฆูุฉ ุงูููู

- `bot_core.bridge`: ุงูุทุจูุฉ ุงููุดุชุฑูุฉ ุงูุชู ุชุนุงูุฌ ูู ูุง ูุฎุต ุงูุชูุนููุ ุญุฏูุฏ ุงูุชูุงุฑูุฑุ ุงูููุงุฆูุ ุงูุชุฑุฌูุฉุ ูุงุณุชูุจุงู ุงููุณุงุฆุท ุจุบุถ ุงููุธุฑ ุนู ููุตุฉ ุงูููู.
- `app.py`: ุจูุงุจุฉ Telegram ุงููุงููุฉ ูุชุดูู ุฃูุงูุฑ ุงูุฅุฏุงุฑุฉ ูููุญุงุช ุงูุณูุจุฑุ ูุชุณุชุฏุนู Functions ุงูุฌุณุฑ (bridge) ููู ุชุฏูู ูุฎุต ุงููุณุชุฎุฏููู.
- `whatsapp_app.py`: ุฎุงุฏู ููุจ ูุจูู ุนูู UltraMsg ูููู ุจุชุทุจูุน Webhook ูุฅุฑุณุงูู ุฅูู ููุณ ุงูุฌุณุฑ ุซู ูุนูุฏ ุชูุฌูู ุงูุฑุฏูุฏ ุฅูู WhatsApp.
- `bot_core/services/*`: ุฎุฏูุงุช ูุณุงูุฏุฉ (PDFุ ุชุฑุฌูุฉุ ุฅุดุนุงุฑุงุชุ ุตูุฑุ ุชูุงุฑูุฑ) ุชูุณุชุฏุนู ูู ุงูุฌุณุฑ ููู Transportุงุช ูุฎุชููุฉ ุจุฏูู ุชูุฑุงุฑ ููุทู.

ุจูุฐุง ุงูุชูุณูู ูููู ุชุดุบูู ุฃู Transport ุนูู ุญุฏุฉ ุฃู ูุนูุง ุฏูู ุงูุฎูู ูู ุงุฎุชูุงู ุงูุณููู ุฃู ุงุฒุฏูุงุฌูุฉ ุงูููุฏ.

## ุงูุฅุนุฏุงุฏ

1) ุฃูุดุฆ ููู `.env` ูู ูุฌูุฏ ุงููุดุฑูุน:
```
TELEGRAM_BOT_TOKEN=123:ABC
API_TOKEN=XYZ123
API_URL=https://api.dejavuplus.com/api/carfax/
TELEGRAM_SUPER_ADMINS=111111111   # ุถุน TG IDs ููุณูุจุฑ ุฃุฏูู ููุตููุฉ ุจููุงุตู
TELEGRAM_ADMINS=
WKHTMLTOPDF_PATH=C:\Program Files\wkhtmltopdf\bin\wkhtmltopdf.exe
# ุชุญููู ูู ุนุฏุฏ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ูููู db.json (ุงุฎุชูุงุฑู)
DB_BACKUP_RETENTION=10
# ุฏุนู ูุงุชุณุงุจ ุนุจุฑ UltraMsg
ULTRAMSG_INSTANCE_ID=your_instance_id
ULTRAMSG_TOKEN=your_ultramsg_token
# URL ุงููุงุนุฏุฉ ุงุฎุชูุงุฑู (ุงูุฅูุชุฑุงุถู https://api.ultramsg.com)
# ULTRAMSG_BASE_URL=https://api.ultramsg.com
WHATSAPP_HOST=0.0.0.0
WHATSAPP_PORT=8080
```

### ูุชุบูุฑุงุช Telegram ุงูุฃุณุงุณูุฉ
- `TELEGRAM_BOT_TOKEN`: ุงูุชููู ุงูุฑุณูู ูุจูุช Telegram (ูู @BotFather).
- `TELEGRAM_SUPER_ADMINS`: ูุงุฆูุฉ ูุนุฑููุงุช ุงููุณุชุฎุฏููู (TG IDs) ุงูุชู ูููููุง ุงููุตูู ูููุญุฉ ุงูุณูุจุฑ ูุฅุฏุงุฑุฉ ุงูุทูุจุงุช.
- `TELEGRAM_ADMINS`: (ุงุฎุชูุงุฑู) ูุนุฑููุงุช ุชููู ุตูุงุญูุงุช ุฃูู ูู ุงูุณูุจุฑ ูููู ูููููุง ูุชุงุจุนุฉ ุงูุทูุจุงุช.

### ูุชุบูุฑุงุช UltraMsg ุงููุทููุจุฉ
- `ULTRAMSG_INSTANCE_ID`: ุฑูู ุงููInstance ูู ููุญุฉ UltraMsg.
- `ULTRAMSG_TOKEN`: ุงูุชููู ุงูุฎุงุต ุจููุณ ุงููInstance ูุชูุฑูุฑู ูู ุงูุงุณุชุฏุนุงุกุงุช.
- `ULTRAMSG_BASE_URL`: ุงุฎุชูุงุฑู ุฅุฐุง ููุช ุชุณุชุฎุฏู ููุทูุฉ ูุฎุชููุฉ ุนู `https://api.ultramsg.com`.
- `WHATSAPP_HOST` ู`WHATSAPP_PORT`: ููุงู ุงุณุชุถุงูุฉ ุฎุงุฏู ุงูููุจ ุงููุญูู ุงูุฐู ูุณุชูุจู Webhooks.

2) ุชุซุจูุช ุงููุชุทูุจุงุช ูุชุดุบูู:
```
python -m venv .venv
# Windows:
.\.venv\Scripts\activate
# Linux/Mac:
source .venv/bin/activate

pip install -r requirements.txt

# ุฅู ุฃุฑุฏุช Playwright:
playwright install chromium

python app.py

# ูุชุดุบูู ุฎุงุฏู ูุงุชุณุงุจ (UltraMsg)
python whatsapp_app.py
```

## ุฃูุถุงุน ุงูุชุดุบูู (Telegram / WhatsApp)

- **Telegram ููุท**: ุดุบูู `python app.py` ุจุนุฏ ุถุจุท `TELEGRAM_BOT_TOKEN` ูุจูุงูุงุช ุงููุดุฑููู. ูู ูุชู ูุชุญ ุฃู ูููุฐ HTTP ุฅุถุงูู.
- **WhatsApp ููุท**: ุดุบูู `python whatsapp_app.py` ูุน ูุชุบูุฑุงุช UltraMsg ุซู ุงุฑุจุท ุนููุงู `https://.../whatsapp/webhook` ูู ุฎุฏูุฉ ุงูููู ุฃู ุงูุงุณุชุถุงูุฉ ูุฏูู.
- **ุชุดุบูู ูุฒุฏูุฌ**: ุงูุชุญ ูุงูุฐุชูู (ุฃู ุงุณุชุฎุฏู `start.ps1`) ูุชุดุบูู ูู ุณูุฑุจุช ุนูู ุญุฏุฉ. ููุงููุง ูุชุนุงููุงู ูุน `db.json` ูุงูุฌุณุฑ ููุณูุ ูุฐูู ูููู ูููุณุชุฎุฏู ุงูุชุจุฏูู ุจูู Telegram ูWhatsApp ุฏูู ุฎุทูุงุช ุฅุถุงููุฉ.

ุงุญุฑุต ุนูู ูุฑุงูุจุฉ ุงูุณุฌูุงุช ูู ูู ุนูููุฉ ุนูู ุญุฏุฉ ููุชุนุงูู ูุน ุฃุฎุทุงุก ุงูููู (HTTP ุฃู Telegram) ุฏูู ุงูุชุฃุซูุฑ ุนูู ุงูุขุฎุฑ.

## ุญุณุงุจุงุช ุชุฌุฑูุจูุฉ (ุฏุงุฎู `db.json`)
- TG: `111111111` (ุญุณุงุจ ุนุงุฏู - ุงุฌุนูู ูู .env ูุณูุจุฑ ุฃุฏูู ููุธูุฑ ูู ุงูุดุงุดุงุช ุงูุฅุฏุงุฑูุฉ)
- TG: `222222222` (ูุณุชุฎุฏู ูุน ุทูุจ ุชูุนูู)
- TG: `333333333` (ูุณุชุฎุฏู ููุนูู ุจุฑุตูุฏ 200 ูุงุดุชุฑุงู 25 ููู)

## ููุงุญุธุงุช
- ุงูุชุฎุฒูู ุงูุงูุชุฑุงุถู ูููู ุจุงููุงูู (`db.json`). ุงุญุฑุต ุนูู ูุณุฎู ุงุญุชูุงุทููุง ุฃู ุงุณุชุจุฏุงูู ุจุจุงู-ุฅูุฏูู ุงูุญูููู ุนู ุทุฑูู ุชุนุฏูู ุทุจูุฉ ุงูุชุฎุฒูู ูู `bot_core/storage.py`.
- ูุชู ุฅูุดุงุก ูุณุฎ ุงุญุชูุงุทูุฉ ุชููุงุฆููุง ุฏุงุฎู ูุฌูุฏ `backups/` ูุน ุงูุญูุงุธ ุนูู ุขุฎุฑ `DB_BACKUP_RETENTION` ูุณุฎุฉ.
- ุฌููุน ุงูุฃุณุฑุงุฑ (TOKEN / Badvin) ุชุถุจุท ูู `.env` ููุท ููุง ูููู ุชุนุฏูููุง ูู ุฏุงุฎู ุงูุจูุช. ุญุฏูุซ ุงูููู ุซู ุงุณุชุฎุฏู ุฒุฑ ุฅุนุงุฏุฉ ุชุญููู `.env`.
- ุชูููุฏ PDF ูุณุชุฎุฏู Playwright ุฃููุงูุ ุซู WeasyPrint/WKHTMLTOPDF ูุจุฏุงุฆู.
- ูุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช ููููู ุงุณุชุฎุฏุงู `pytest tests/test_all.py`.

## ุชูุงูู ูุงุชุณุงุจ (UltraMsg)

1. ูุนูู ุญุณุงุจ UltraMsg ูุฃูุดุฆ Instance ูู ููุญุฉ ุงูุชุญูู ุซู ุงุญุตู ุนูู `instance_id` ู `token`.
2. ุญุฏูุซ ููู `.env` ุจุงูููู ุงูุชุงููุฉ:
	- `ULTRAMSG_INSTANCE_ID`
	- `ULTRAMSG_TOKEN`
	- (ุงุฎุชูุงุฑู) `ULTRAMSG_BASE_URL` ุฅุฐุง ููุช ุชุณุชุฎุฏู ููุทูุฉ ูุฎุชููุฉ.
3. ุดุบูู ุฎุงุฏู ุงูููุจ:
	```bash
	python whatsapp_app.py
	```
4. ุฅุฐุง ุงุฎุชุจุฑุช ูุญูููุงุ ุงุณุชุฎุฏู ุฃุฏุงุฉ ููู ูุซู ngrok:
	```bash
	ngrok http 8080
	```
	ุซู ุงูุณุฎ ุฑุงุจุท HTTPS ุงููุงุชุฌ ูุงุถุจุทู ุฏุงุฎู ููุญุฉ UltraMsg ูู Webhook ุนูู ุงููุณุงุฑ `/whatsapp/webhook`.
5. ุงูุขู ุฃู ุฑุณุงูุฉ ูุงุชุณุงุจ ุชูุฑุณู ุฅูู ุฑูู UltraMsg ุณุชุตู ุฅูู ููุณ ููุทู ุงูุจูุช ุนุจุฑ ุงูุฌุณุฑ `bot_core.bridge`.

## ุงููุดุฑููู ูุงูุณูุจุฑ ุฃุฏูู

- ุฌููุน ุฅุฌุฑุงุกุงุช ุงูุฅุฏุงุฑุฉ (ููุงุฆู ุงูุงูุชุธุงุฑุ ุถุจุท ุงูุญุฏูุฏุ ุงูุฅุดุนุงุฑุงุช ุงูุฌูุงุนูุฉุ ููุญุฉ ุงูุณูุจุฑ) ุชุชู ูู ุฎูุงู ูุงุฌูุฉ Telegram ููุท ูุฃููุง ุชุนุชูุฏ ุนูู ุฃุฒุฑุงุฑ Inline ูุชูุงููุงุช ุฎุงุตุฉ ุจูุงุฌูุฉ Telegram.
- ูููู ูููุณุชุฎุฏููู ุงูููุงุฆููู ุงุณุชุฎุฏุงู WhatsApp ูุชูุฏูู ุงูุทูุจุงุชุ ุฅุฑุณุงู VINุ ุฃู ุฑูุน ุงููุณุงุฆุทุ ููู ูู ูุชูููุง ุฃุฒุฑุงุฑ ุงูุฅุฏุงุฑุฉ ุฃู ุฃูุงูุฑ ุงููุดุฑููู ุนุจุฑ WhatsApp.
- ุงุญุชูุธ ุจูุงุฆูุฉ `TELEGRAM_SUPER_ADMINS` ูุญุฏูุซุฉ ูุถูุงู ุฃู ูู ุงูุนูููุงุช ุงูุญุณุงุณุฉ (ุงูุชูุนููุ ุฑูุน ุงูุญุฏูุฏุ ูุฑุงูุจุฉ ุงูุงุณุชุฎุฏุงู) ุชุจูู ุถูู Telegram ุญูุซ ูุชู ุญูุธ ุณูุงู ุงููุญุงุฏุซุงุช ุงูุฅุฏุงุฑูุฉ.

## ุงูุฎุทุฉ ุงูุชูููุฐูุฉ ุงูุดุงููุฉ ูููุดุฑูุน

### 1. ุงูุจููุฉ ุงููุนูุงุฑูุฉ
| ุงููููู | ุงููุธููุฉ |
| --- | --- |
| `app.py` | ุงูููุจ ุงูุชุดุบููู: ุฃูุงูุฑ ุงูุจูุชุ ููุญุฉ ุงูุฃุฒุฑุงุฑุ ูุนุงูุฌุฉ VINุ ุฅุฏุงุฑุฉ ุงูุฑุตูุฏุ ููุญุฉ ุงูุณูุจุฑุ ุงูุชูุฏููุงุช ุงูุฑุณูููุฉ. |
| `bot_core/storage.py` | ุทุจูุฉ ุงูุชุฎุฒูู ุงูููููุฉ: ุฅูุดุงุก ุงููุณุชุฎุฏูููุ ุญุฏูุฏ ุงูุฑุตูุฏุ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉุ ุณุฌู ุงูุชุฏููู. |
| `bot_core/services/*` | ุฎุฏูุงุช ูุณุงูุฏุฉ (PDFุ ุชุฑุฌูุฉุ ุตูุฑ BadVin/Apicarุ ุฅุดุนุงุฑุงุช ุขููุฉุ ุฃุฏูุงุช VIN). |
| `badvin.py` | ุณูุฑุจุช ูุชุฒุงูู ูุฌูุจ ุตูุฑ ุงููุฒุงุฏุงุช ูู BadVin (ููุณุชุฏุนู ุนุจุฑ `services/images`). |
| `backups/` | ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุงูุฏูุฑูุฉ ูููู `db.json` (ุนุฏุฏูุง ูุถุจุทู `DB_BACKUP_RETENTION`). |
| `tests/` | ุงุฎุชุจุงุฑุงุช ูุญุฏุงุช (ูุฌูุนุฉ ูู `tests/test_all.py`). |

### 2. ุฑุญูุฉ ุงููุณุชุฎุฏู
1. `/start` ุฃู ุฒุฑ "๐ ุงุจุฏุฃ ุงูุขู" ููุนูู ููุญุฉ ReplyKeyboard ุฏุงุฆููุง.
2. ุงูููุญุฉ ุงูุฑุฆูุณูุฉ ุชุนุฑุถ ุงูุฃุฒุฑุงุฑ ุงูุชุงููุฉ ูููุณุชุฎุฏู ุงูููุงุฆู:
	- `๐ ุชูุฑูุฑ ุฌุฏูุฏ`: ูุฑุดุฏ ูุฅุฑุณุงู VIN ููุนุฑุถ ุงูุญุฏูุฏ ุงูุญุงููุฉ.
	- `๐ค ุจูุงูุงุชู`: ููุฎุต ุงูุญุณุงุจุ ุงูุฑุตูุฏุ ุงูุงุดุชุฑุงูุ ุงูุฎุฏูุงุช ุงูููุนูุฉ.
	- `๐ณ ุฑุตูุฏู`: ุชูุงุตูู ุงูุงุณุชุฎุฏุงู ุงููููู/ุงูุดูุฑู ุงููุชุจูู.
	- `๐ ุทูุจ ุชูุนูู`: ูุฑุณู ุทูุจ ุชูุนูู ูุน ุฑูู ุงููุงุชู (ูุฑุฉ ูุงุญุฏุฉ ููุท ุญุชู ููุจุช ููู).
	- `๐ ูุบุฉ ุงูุชูุฑูุฑ`: ุชุจุฏูู ููุฑู ุจูู ุงูุนุฑุจูุฉ/ุงูุฅูุฌููุฒูุฉ/ุงููุฑุฏูุฉ ูุน ูุงุฌูุฉ Inline.
	- `๐ ุงููุณุงุนุฏุฉ ูุงูุชูุงุตู`: ุฑูุงุจุท ูุงุชุณุงุจ/ูููุน/ุจุฑูุฏ + ุฃุณุฆูุฉ ุดุงุฆุนุฉ.
3. ูู ุญุงูุฉ ุงูุญุณุงุจ ุบูุฑ ุงูููุนูู ุฃู ุงูููุชููุ ูุชู ุฅุธูุงุฑ ุฑุณุงูุฉ ูุฎุตุตุฉ ุชููุน ุฅุฑุณุงู ุฃู ุชูุฑูุฑ ูุชูุฌู ููุชูุงุตู ูุน ุงูุฅุฏุงุฑุฉ.

### 3. ุชุฏูู ุงูุชูุนูู ูุงูุงุดุชุฑุงูุงุช
| ุงููุฑุญูุฉ | ุงูุชูุงุตูู |
| --- | --- |
| ุงูุทูุจ | ุนูุฏ ุถุบุท "๐ ุทูุจ ุชูุนูู" ูุชู ุฌูุน ุฑูู ุงููุงุชู ูุฅุฏุฑุงุฌ ุงููุณุชุฎุฏู ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ `pending`. |
| ุงุนุชูุงุฏ ุงูุทูุจ | ุงูุณูุจุฑ ุฃุฏูู ูุชููู ููุญุฉ Pending: ุฎูุงุฑุงุช ุชุฌุฑุจุฉุ ุฎุทุฉ ุดูุฑูุฉุ ุชูุนูู ูุฎุตูุตุ ุฑูุถ. |
| ุถุจุท ุงูุญุฏูุฏ | `_set_user_limits` ูุนูุฏ ุถุจุท `daily/monthly` ูุงุณุชููุงูุงุชููุงุ ูุน ุญูุธ ุชุงุฑูุฎ ุงูุชูุนูู ูุงูุงูุชูุงุก. |
| ุงูุฅุดุนุงุฑุงุช | ุงููุณุชุฎุฏู ููุฎุทุฑ ุจุงูุชูุงุตููุ ูุงูุณูุจุฑ ุฃุฏูู ูุชููู ุณุฌููุง ูู ููุญุฉ ุงูุณูุจุฑ ููุฐูู ุฅุดุนุงุฑุงุช Telegram. |
| ุงูุชุฌุฏูุฏ ุงูุฐูู | ูุจู ููู ูู ุงูุชูุงุก ุงูุงุดุชุฑุงู ุชูุฑุณู ุฑุณุงูุฉ ูููุณุชุฎุฏู + ุฅุดุนุงุฑ ููุณูุจุฑ ูุน ุฒุฑ `๐ ุฌุฏูุฏ ุงูุฎุทุฉ` ููุชุฑุญ ููุณ ุงูุญุฏูุฏุ ุฃู `โ ุชุฌุงูู ุงูููู`. |

### 4. ูุธุงู ุงูุฑุตูุฏ ูุงูุงุณุชููุงู
- ุนูุฏ ุงุณุชูุจุงู VIN ุตุญูุญ ูุชู ุชูููุฐ `_reserve_report_slot` ุฏุงุฎู ููู ุงููุณุชุฎุฏู ูุถูุงู ุนุฏู ูุฌูุฏ ุณุจุงูุงุชุ ููุฎุตู ุฑุตูุฏูุง ููุฑููุง.
- ูุฌุงุญ ุงูุชูุฑูุฑ ูุณุชุฏุนู `_finalize_report_request(... delivered=True)` ูุชุญุฏูุซ ุงูุฅุญุตุงุกุงุช ูุฅุจูุงุก ุงูุฑุตูุฏ ุงููุฎุตูู.
- ุฃู ูุดู (APIุ ุชุญููู PDFุ ุตูุฑ) ูุณุชุฏุนู `_finalize_report_request(... delivered=False)` ูุฅุฑุฌุงุน ุงูุฑุตูุฏ ูุฅุนูุงู ุงููุณุชุฎุฏู.
- ุญุฏูุฏ ููููุฉ/ุดูุฑูุฉ ุชุฑุงูุจ ุชููุงุฆููุงุ ูุงูุจููุบ ูุคุฏู ุฅูู ููู ุฃุฒุฑุงุฑ ุงูุชูุงุฑูุฑ ูุฅุธูุงุฑ ุฒุฑ "๐ ุงุทูุจ ุฑูุน ุงูุญุฏ" ุงูุฐู ูุฑุณู ุทูุจูุง ููุณูุจุฑ ุฃุฏูู.

### 5. ูุนุงูุฌุฉ ุงูุชูุงุฑูุฑ (VIN)
1. ุงูุชุญูู ูู ุตุญุฉ VIN (17 ุฎุงูุฉ) + ุชูุธูู ุงููุฏุฎูุงุช.
2. ุฑุณุงูุฉ ุชูุฏู ุชุชุถูู:
	- ุดุฑูุท `_make_progress_bar`.
	- ุงูุฑุตูุฏ ุงูุดูุฑู ุงููุชุจูู.
	- ุงูุงุณุชุฎุฏุงู ุงููููู ุงูุญุงูู.
	- ุงูุฃูุงู ุงููุชุจููุฉ ููุงุดุชุฑุงู.
3. ุงุณุชุฏุนุงุก API ุงูุฎุงุฑุฌู (`_call_carfax_api`) ูุน ูููุฉ ูุฅุนุงุฏุฉ ุงููุญุงููุฉ.
4. ุงููุณุงุฑุงุช ุงููุญุชููุฉ:
	- `pdf_bytes` ุญุงุถุฑ โ ุฅุฑุณุงู ุงูููู ููุฑูุง.
	- `json/html/url` โ ุชุญููู HTML ูุน Playwright (ููุฏุนู ุงูุชุฑุฌูุฉ ููุบุงุช RTL)ุ ูู ุญุงู ุงููุดู ูุณุชุฎุฏู WeasyPrint.
5. ุจุนุฏ ุงูุชุณููู: ุนุฑุถ ุฃุฒุฑุงุฑ ุตูุฑ BadVin/Apicar ุญุณุจ ุงูุฎุฏูุงุช ุงูููุนูุฉ.
6. ูู ุญุฏุซ (ูุฌุงุญุ ูุดูุ ุงุณุชุฑุฏุงุฏ ุฑุตูุฏ) ูุณุฌู ูู ููุญุฉ ุงูุณูุจุฑ.

### 6. ุฎุฏูุงุช ุงูุตูุฑ ูุงูููุญูุงุช
| ุฒุฑ | ุงููุตุฏุฑ | ุงูููุงุญุธุงุช |
| --- | --- | --- |
| `๐ท ุตูุฑ ุงูุณูุงุฑุฉ ุงููุฎููุฉ` | BadVin (ูุชุทูุจ `BADVIN_EMAIL/PASSWORD`) | ูุชู ุงูุชุฎุฒูู ุงููุคูุช 15 ุฏูููุฉุ ุชุฌุงูู ุงูุตูุฑ ููุชูุงุฉ (ุดุนุงุฑุงุชุ ูุฏููุนุงุช). |
| `๐ ุตูุฑ ุงููุฒุงุฏ ุงูุญุงูู` | Apicar `cars/vin/all` | ุงุฎุชูุงุฑ ุฐูู ูุฃูุถู ุงูุฑูุงุจุท HD ูุฅุฒุงูุฉ ุงูููุฑุฑุงุช. |
| `๐ฅ ุตูุฑ ุญุงุฏุซ ุณุงุจู` | Apicar `sale-histories/vin` | ูุฌูุน ุงูุตูุฑ ูู ุชุงุฑูุฎ ุงููุฒุงุฏุงุช ุจุงููุงูู. |
| `๐ ุฑูุงุจุท ุฅุถุงููุฉ` | ูู ุญุงู ูุฌูุฏ ุฑูุงุจุท ูุตูุฉ ูุฑุณููุง API ูุชู ุชุญููููุง ุชููุงุฆููุง. |

### 7. ููุญุฉ ุงูุณูุจุฑ (Dashboard) ูุงูู CRM
- ุฃูุฑ `/dashboard` ุฃู `/superdash` ูุฑุณู ููุญุฉ ูุงุญุฏุฉ ููู ุฏุฑุฏุดุฉ ุณูุจุฑ.
- ูุญุชููุงุช ุงูููุญุฉ:
  - ุฅุฌูุงูู ุงููุณุชุฎุฏูููุ ุงููุดุทููุ ุงูููุชูููุ ุงูุฐูู ุณููุชููู ุฎูุงู 3 ุฃูุงู.
  - ุนุฏุฏ ุงูุชูุงุฑูุฑ ุงูููู/ุงูุดูุฑุ ุนุฏุฏ ุงูุชูุงุฑูุฑ ููุฏ ุงูุชูููุฐุ ุทูุจุงุช ุงูุชูุนูู ุงููุนููุฉ.
  - ุขุฎุฑ ุซูุงุซุฉ ูุณุชุฎุฏููู ุณุญุจูุง ุชูุงุฑูุฑ ูุน ุงูุทุงุจุน ุงูุฒููู.
  - ุณุฌู ุฃุญุฏุงุซ ุญูู (ุญุชู 15 ุณุทุฑูุง): ุชุณููู/ูุดู ุชูุงุฑูุฑุ ุชุฌุฏูุฏุงุชุ ุชุนุทูู ุฎุฏูุงุชุ ุชูุจููุงุช ุญุฏูุฏ.
- ุงูุฃุฒุฑุงุฑ: `โป ุชุญุฏูุซ` ูุชุญุฏูุซ ุงูููุทุฉุ `โ ุฅุฎูุงุก` ูุฅุฒุงูุฉ ุงูููุญุฉ ูุชุญุฑูุฑ ุงููุณุชูุน.
- ูุชู ุชุญุฏูุซ ุงูููุญุฉ ุชููุงุฆููุง ูู `_super_dashboard_event` ุนูุฏ ุฃู ุนูููุฉ ูููุฉ.

### 8. ููุญุงุช ุงูุฅุฏุงุฑุฉ (Inline Panels)
- **ููุญุฉ ุงููุณุชุฎุฏููู**: ููู ูุณุชุฎุฏู ุตู ูุญูู ุงููุงุชูุ ุชุงุฑูุฎ ุงูุงูุชูุงุกุ ุงูุญุงูุฉุ ุฒุฑ ุญุฐูุ ูุฃุฒุฑุงุฑ ุชููู ุงูุตูุญุฉ.
- **ููุญุฉ ุงูุฎุฏูุงุช**: ุชุดุบูู/ุฅููุงู Carfaxุ ุตูุฑ BadVinุ ุตูุฑ ุงููุฒุงุฏุ ุตูุฑ ุงูุญูุงุฏุซ.
- **ููุญุฉ ุงูุญุฏูุฏ**: ุชุนุฏูู ุงูุญุฏ ุงููููู/ุงูุดูุฑูุ ุชุตููุฑ ุงูุงุณุชููุงู ุงููููู.
- **ููุญุฉ ุงูุงูุชุธุงุฑ**: ูุจูู/ุฑูุถ ุทูุจุงุช ุงูุชูุนูู ูุน ุฃุฒุฑุงุฑ ุฅุนุฏุงุฏ ูุณุจู.
- **ููุญุฉ ุฅุนุฏุงุฏุงุช ุงููุธุงู**: ุญุตุฑูุฉ ููุณูุจุฑ ุฃุฏูู ูุชุดูู ุฅุนุงุฏุฉ ุชุญููู `.env`ุ ุถุจุท ููุงุชูุญ APIุ ุงูุชุญูู ูู ูุชุบูุฑุงุช ุงูุชุดุบูู.

### 9. ุงูุฅุดุนุงุฑุงุช ูุงูุฃุญุฏุงุซ
| ุงููุณุชูู | ููุน ุงูุฅุดุนุงุฑ |
| --- | --- |
| ุงููุณุชุฎุฏู | ูุจูู/ุฑูุถ ุงูุชูุนููุ ุงูุชุฑุงุจ ุงูุชูุงุก ุงูุงุดุชุฑุงูุ ุงูุชูุงุก ุงูุงุดุชุฑุงูุ ููุงุฏ ุงูุญุฏ ุงููููู/ุงูุดูุฑูุ ุงูุฎูุงุถ ุงูุฑุตูุฏ ุฅูู ุฃูู ูู 5 ุชูุงุฑูุฑุ ูุดู ุณุญุจ ุงูุชูุฑูุฑ ูุน ุงุณุชุฑุฏุงุฏ ุงูุฑุตูุฏ. |
| ุงูุณูุจุฑ ุฃุฏูู | ุทูุจุงุช ุฑูุน ุงูุญุฏุ ุทูุจุงุช ุงูุชูุนููุ ุงูุชูุงุก ุงูุงุดุชุฑุงูุงุช ุบุฏูุง (ูุน ุฃุฒุฑุงุฑ ุงูุชุฌุฏูุฏ)ุ ูุฌุงุญ/ูุดู ุงูุชูุงุฑูุฑุ ุชุฌุฏูุฏุงุช ุชููุงุฆูุฉุ ุญูุงุฏุซ ุงูุตูุฑ. |
| ููุญุฉ ุงูุณูุจุฑ | ุชุณุฌูู ูู ุงูุฃุญุฏุงุซ ุงูุณุงุจูุฉ ูุฃุฑุดูู ุญู ุจุฏูุงู ูู ุฅุบุฑุงู ุงูุณูุจุฑ ุจุงูุฑุณุงุฆู ุงููุฑุฏูุฉ. |

### 10. ุงูุชุฎุฒูู ูุงููุณุฎ ุงูุงุญุชูุงุทู
- ููู `db.json` ูู ุงููุตุฏุฑ ุงููุญูุฏ ูุญุงูุฉ ุงููุธุงู (ูุณุชุฎุฏูููุ ุญุฏูุฏุ ุทูุจุงุช).
- `bot_core/storage.save_db` ููุดุฆ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุจู ูู ูุชุงุจุฉ ุฏุงุฎู ูุฌูุฏ `backups/`.
- ููุงุชูุญ ุงููุณุฎ ุงูุงุญุชูุงุทู: `DB_BACKUP_RETENTION` ูุชุญุฏูุฏ ุฃูุตู ุนุฏุฏ ูููุงุช ูุญููุธุฉ.
- ูููู ุงุณุชุจุฏุงู ูุฐู ุงูุทุจูุฉ ูุงุญููุง ุจูุงุนุฏุฉ ุจูุงูุงุช ุฎุงุฑุฌูุฉ ุจูุถู ุงูุชูุฑูุฒ ูู `bot_core/storage.py`.

### 11. ุงูุฅุนุฏุงุฏ ูุงูุชุดุบูู
1. ุฅุนุฏุงุฏ `.env` ุจุงูููู ุงููุงุฒูุฉ (Telegram, API, BadVin, Apicar, ุญุฏูุฏ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ).
2. ุฅูุดุงุก ุจูุฆุฉ ุงูุชุฑุงุถูุฉ ูุชุซุจูุช ุงููุชุทูุจุงุช ูู `requirements.txt`.
3. (ุงุฎุชูุงุฑู) ุชุซุจูุช Playwright Chromium ูู PDF ุนุงูู ุงูุฌูุฏุฉ.
4. ุงูุชุดุบูู ุงููุญูู: `python app.py`.
5. ุงูุชุดุบูู ุงูุฅูุชุงุฌู: ุงุณุชุฎุฏู `start.ps1` ุฃู ุฎุฏูุฉ Windows/ููููุณ ูุน ูุฑุงูุจุฉ ุงูุณุฌูุงุช.
6. ุงุฎุชุจุงุฑ ุงููุญุฏุฉ: `pytest` (ูุชุทูุจ Playwright/WeasyPrint ููุท ุฅุฐุง ุฃุฑุฏุช ุงุฎุชุจุงุฑ ูุณุงุฑุงุช PDF ุนููููุง).

### 12. ูุฑุงูุจุฉ ุงูุฌูุฏุฉ ูุงูุงุฎุชุจุงุฑุงุช
- `tests/test_vin_utils.py` ูุคูุฏ ุฃุฏูุงุช VIN (ุงูุชุทุจูุน/ุงูุชุญูู).
- `tests/conftest.py` ูุถูู ุงููุณุงุฑ ุงูุฌุฐุฑู ูู `sys.path` ุชููุงุฆููุง ูุถูุงู ุนูู ุงูุงุฎุชุจุงุฑุงุช ุนูู ุฃู ุจูุฆุฉ CI.
- ููุตู ุจุฅุถุงูุฉ ุงุฎุชุจุงุฑุงุช ุชูุงูู ูุงุญููุง ููุงุฌูุงุช ุงูุชูุนููุ ุงูุฑุตูุฏุ ููุญุฉ ุงูุณูุจุฑ.

### 13. ููุงุท ุงูุชูุณุนุฉ ุงููุณุชูุจููุฉ
- ุชูุญูุฏ ุงูุชุฎุฒูู ูุน ูุงุนุฏุฉ ุจูุงูุงุช SQL ุฃู MongoDB.
- ุจูุงุก REST Dashboard ุฎุงุฑุฌู ููุฑุฃ ูู `db.json` ุฃู ูู ูุตุฏุฑ ุงูุจูุงูุงุช ุงูุฌุฏูุฏ.
- ุฅุถุงูุฉ ุตูุงูุฉ ุฐุงุชูุฉ (ูุซุงู: ุชูุธูู ุฐุงุชู ูุทูุจุงุช ุงูุชูุนูู ุงููุฏููุฉ/ุงููุฌูุฏูุฉ).
- ุฏูุฌ ูุฑุงูุจุฉ ุฎุงุฑุฌูุฉ (Sentryุ Prometheus) ูุฑุตุฏ ุงูุฃุนุทุงู.

